clear; clc;
syms d1 d2 d3 d4 d5 d6 x xd q0dd q1 q1d q1dd q2 q2d q2dd g u d1 d2 d3 d4 d5 d6
m0=0.8; m1=0.5; m2=0.3; L1=0.3; L2=0.2; l1=0.15; l2=0.1; I1=0.006; I2=0.006; g=9.8;
d1=(m0+m1+m2);
d2=(m1*l1+m2*L1);
d3=m1*l1^2+m2*L1^2+I1;
d4=m2*l2;
d5=m2*L1*l2;
d6=m2*l2^2+I2;

% p1=d1*q0dd + d2*q1dd*cos(q1) + d4*q2dd*cos(q2)-d2*(q1d^2)*sin(q1)- d4*(q2d^2)*sin(q2)-u;
% p2=d2*q0dd*cos(q1) + d3*q1dd + d5*q2dd*cos(q1-q2) + d5*(q2d^2)*sin(q1-q2)-d2*g*sin(q1);
% p3=d4*q0dd*cos(q2) + d5*q1dd*cos(q1-q2)+d6*q2dd - d5*sin(q1-q2)*(q1d^2) - d4*g*sin(q2);
% [q0dd,q1dd,q2dd]=solve(p1,p2,p3,q0dd,q1dd,q2dd)

q0dd = -(d3*d6*u - d5^2*u*cos(q1 - q2)^2 + d2*d3*d6*q1d^2*sin(q1) + ...
    d3*d4*d6*q2d^2*sin(q2) - d2*d5^2*q1d^2*cos(q1 - q2)^2*sin(q1) - ...
    d4*d5^2*q2d^2*cos(q1 - q2)^2*sin(q2) - d2^2*d6*g*cos(q1)*sin(q1)...
    - d3*d4^2*g*cos(q2)*sin(q2) + d2*d5^2*q1d^2*cos(q1 - q2)*sin(q1 ...
    - q2)*cos(q1) - d4*d5^2*q2d^2*cos(q1 - q2)*sin(q1 - q2)*cos(q2) ...
    - d3*d4*d5*q1d^2*sin(q1 - q2)*cos(q2) + d2*d5*d6*q2d^2*sin(q1 - ...
    q2)*cos(q1) + d2*d4*d5*g*cos(q1 - q2)*cos(q1)*sin(q2) + d2*d4*d5...
    *g*cos(q1 - q2)*cos(q2)*sin(q1))/(d3*d4^2*cos(q2)^2 - d1*d3*d6 +...
    d2^2*d6*cos(q1)^2 + d1*d5^2*cos(q1 - q2)^2 - 2*d2*d4*d5*cos(q1 -...
    q2)*cos(q1)*cos(q2));
q1dd = (d2*d6*u*cos(q1) + d2*d4^2*g*cos(q2)^2*sin(q1) + d2^2*d6*q1d^...
    2*cos(q1)*sin(q1) + d1*d5^2*q1d^2*cos(q1 - q2)*sin(q1 - q2) + d1...
    *d5*d6*q2d^2*sin(q1 - q2) - d4*d5*u*cos(q1 - q2)*cos(q2) - d4^2*...
    d5*q2d^2*sin(q1 - q2)*cos(q2)^2 - d1*d2*d6*g*sin(q1) - d4^2*d5*q2d...
    ^2*cos(q1 - q2)*cos(q2)*sin(q2) + d2*d4*d6*q2d^2*cos(q1)*sin(q2)...
    - d2*d4^2*g*cos(q1)*cos(q2)*sin(q2) + d1*d4*d5*g*cos(q1 - q2)*sin(q2)...
    - d2*d4*d5*q1d^2*cos(q1 - q2)*cos(q2)*sin(q1) - d2*d4*d5*q1d^2*...
    sin(q1 - q2)*cos(q1)*cos(q2))/(d3*d4^2*cos(q2)^2 - d1*d3*d6 + ...
    d2^2*d6*cos(q1)^2 + d1*d5^2*cos(q1 - q2)^2 - 2*d2*d4*d5*cos(q1 - q2)...
    *cos(q1)*cos(q2));
q2dd = (d3*d4*u*cos(q2) + d2^2*d4*g*cos(q1)^2*sin(q2) + d3*d4^2*q2d^2*...
    cos(q2)*sin(q2) - d1*d5^2*q2d^2*cos(q1 - q2)*sin(q1 - q2) - d1*d3*...
    d5*q1d^2*sin(q1 - q2) - d2*d5*u*cos(q1 - q2)*cos(q1) + d2^2*d5*q1d^2*...
    sin(q1 - q2)*cos(q1)^2 - d1*d3*d4*g*sin(q2) - d2^2*d5*q1d^2*cos(q1 -...
    q2)*cos(q1)*sin(q1) + d2*d3*d4*q1d^2*cos(q2)*sin(q1) - d2^2*d4*g*...
    cos(q1)*cos(q2)*sin(q1) + d1*d2*d5*g*cos(q1 - q2)*sin(q1) - d2*d4*...
    d5*q2d^2*cos(q1 - q2)*cos(q1)*sin(q2) + d2*d4*d5*q2d^2*sin(q1 - q2)*...
    cos(q1)*cos(q2))/(d3*d4^2*cos(q2)^2 - d1*d3*d6 + d2^2*d6*cos(q1)^2 +...
    d1*d5^2*cos(q1 - q2)^2 - 2*d2*d4*d5*cos(q1 - q2)*cos(q1)*cos(q2));

a21=diff(q0dd,'q0');
a22=diff(q0dd,'q0d');
a23=diff(q0dd,'q1');
a24=diff(q0dd,'q1d');
a25=diff(q0dd,'q2');
a26=diff(q0dd,'q2d');
a41=diff(q1dd,'q0');
a42=diff(q1dd,'q0d');
a43=diff(q1dd,'q1');
a44=diff(q1dd,'q1d');
a45=diff(q1dd,'q2');
a46=diff(q1dd,'q2d');
a61=diff(q2dd,'q0');
a62=diff(q2dd,'q0d');
a63=diff(q2dd,'q1');
a64=diff(q2dd,'q1d');
a65=diff(q2dd,'q2');
a66=diff(q2dd,'q2d');
b2=diff(q0dd,'u');
b4=diff(q1dd,'u');
b6=diff(q2dd,'u');
x=0; xd=0; q1=0; q1d=0; q2=0; q2d=0; u=0;
% A=[0 1 0 0 0 0;a21 a22 a23 a24 a25 a26;0 0 0 1 0 0;a41 a42 a43 a44 a45 a46;0 0 0 0 0 1;a61 a62 a63 a64 a65 a66]
% B=[0;b2;0;b4;0;b6];

A =[0, 1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0;
    0, 0,                                 - ((4848634446054187*q1d^2*cos(q1))/73786976294838206464 - (692111749582417*cos(q1)^2)/288230376151711744 + (692111749582417*sin(q1)^2)/288230376151711744 - (7052559194260635*q1d^2*cos(q1 - q2)*cos(q2))/590295810358705651712 + (7889303505444101*q2d^2*cos(q1 - q2)*cos(q1))/590295810358705651712 + (2013415998785213*cos(q1 - q2)*cos(q1)*cos(q2))/4611686018427387904 - (7889303505444101*q2d^2*sin(q1 - q2)*sin(q1))/590295810358705651712 - (2013415998785213*cos(q1 - q2)*sin(q1)*sin(q2))/4611686018427387904 - (2013415998785213*sin(q1 - q2)*cos(q1)*sin(q2))/4611686018427387904 - (2013415998785213*sin(q1 - q2)*cos(q2)*sin(q1))/4611686018427387904 - (2868837638343309*q2d^2*cos(q1 - q2)^2*cos(q2))/1180591620717411303424 - (7889303505444099*q1d^2*sin(q1 - q2)^2*cos(q1))/590295810358705651712 + (2868837638343309*q2d^2*sin(q1 - q2)^2*cos(q2))/1180591620717411303424 + (2988372539940947*u*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 + (7889303505444099*q1d^2*cos(q1 - q2)*sin(q1 - q2)*sin(q1))/590295810358705651712 + (2868837638343309*q2d^2*cos(q1 - q2)*sin(q1 - q2)*sin(q2))/590295810358705651712)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976) - (((2259956733330341*cos(q1)*sin(q1))/4611686018427387904 + (4781396063905515*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*cos(q1 - q2)*cos(q2)*sin(q1))/73786976294838206464 - (6574419587870083*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)*((7346415827354829*u)/18446744073709551616 + (4848634446054187*q1d^2*sin(q1))/73786976294838206464 + (1763139798565159*q2d^2*sin(q2))/147573952589676412928 - (692111749582417*cos(q1)*sin(q1))/288230376151711744 - (7199487510807733*cos(q2)*sin(q2))/18446744073709551616 - (2988372539940947*u*cos(q1 - q2)^2)/36893488147419103232 - (7052559194260635*q1d^2*sin(q1 - q2)*cos(q2))/590295810358705651712 + (7889303505444101*q2d^2*sin(q1 - q2)*cos(q1))/590295810358705651712 + (2013415998785213*cos(q1 - q2)*cos(q1)*sin(q2))/4611686018427387904 + (2013415998785213*cos(q1 - q2)*cos(q2)*sin(q1))/4611686018427387904 - (7889303505444099*q1d^2*cos(q1 - q2)^2*sin(q1))/590295810358705651712 - (2868837638343309*q2d^2*cos(q1 - q2)^2*sin(q2))/1180591620717411303424 + (7889303505444099*q1d^2*cos(q1 - q2)*sin(q1 - q2)*cos(q1))/590295810358705651712 - (2868837638343309*q2d^2*cos(q1 - q2)*sin(q1 - q2)*cos(q2))/1180591620717411303424))/((4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 + (2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 - 734641582735483/1152921504606846976)^2,          -((4848634446054187*q1d*sin(q1))/36893488147419103232 - (7889303505444099*q1d*cos(q1 - q2)^2*sin(q1))/295147905179352825856 - (7052559194260635*q1d*sin(q1 - q2)*cos(q2))/295147905179352825856 + (7889303505444099*q1d*cos(q1 - q2)*sin(q1 - q2)*cos(q1))/295147905179352825856)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976), - ((1763139798565159*q2d^2*cos(q2))/147573952589676412928 - (7199487510807733*cos(q2)^2)/18446744073709551616 + (7199487510807733*sin(q2)^2)/18446744073709551616 + (7052559194260635*q1d^2*cos(q1 - q2)*cos(q2))/590295810358705651712 - (7889303505444101*q2d^2*cos(q1 - q2)*cos(q1))/590295810358705651712 + (2013415998785213*cos(q1 - q2)*cos(q1)*cos(q2))/4611686018427387904 + (7052559194260635*q1d^2*sin(q1 - q2)*sin(q2))/590295810358705651712 - (2013415998785213*cos(q1 - q2)*sin(q1)*sin(q2))/4611686018427387904 + (2013415998785213*sin(q1 - q2)*cos(q1)*sin(q2))/4611686018427387904 + (2013415998785213*sin(q1 - q2)*cos(q2)*sin(q1))/4611686018427387904 - (7889303505444099*q1d^2*cos(q1 - q2)^2*cos(q1))/590295810358705651712 + (7889303505444099*q1d^2*sin(q1 - q2)^2*cos(q1))/590295810358705651712 - (2868837638343309*q2d^2*sin(q1 - q2)^2*cos(q2))/1180591620717411303424 - (2988372539940947*u*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (7889303505444099*q1d^2*cos(q1 - q2)*sin(q1 - q2)*sin(q1))/295147905179352825856 - (2868837638343309*q2d^2*cos(q1 - q2)*sin(q1 - q2)*sin(q2))/1180591620717411303424)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976) - (((5877132661883863*cos(q2)*sin(q2))/73786976294838206464 - (4781396063905515*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*cos(q1 - q2)*cos(q1)*sin(q2))/73786976294838206464 + (6574419587870083*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)*((7346415827354829*u)/18446744073709551616 + (4848634446054187*q1d^2*sin(q1))/73786976294838206464 + (1763139798565159*q2d^2*sin(q2))/147573952589676412928 - (692111749582417*cos(q1)*sin(q1))/288230376151711744 - (7199487510807733*cos(q2)*sin(q2))/18446744073709551616 - (2988372539940947*u*cos(q1 - q2)^2)/36893488147419103232 - (7052559194260635*q1d^2*sin(q1 - q2)*cos(q2))/590295810358705651712 + (7889303505444101*q2d^2*sin(q1 - q2)*cos(q1))/590295810358705651712 + (2013415998785213*cos(q1 - q2)*cos(q1)*sin(q2))/4611686018427387904 + (2013415998785213*cos(q1 - q2)*cos(q2)*sin(q1))/4611686018427387904 - (7889303505444099*q1d^2*cos(q1 - q2)^2*sin(q1))/590295810358705651712 - (2868837638343309*q2d^2*cos(q1 - q2)^2*sin(q2))/1180591620717411303424 + (7889303505444099*q1d^2*cos(q1 - q2)*sin(q1 - q2)*cos(q1))/590295810358705651712 - (2868837638343309*q2d^2*cos(q1 - q2)*sin(q1 - q2)*cos(q2))/1180591620717411303424))/((4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 + (2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 - 734641582735483/1152921504606846976)^2,           -((1763139798565159*q2d*sin(q2))/73786976294838206464 - (2868837638343309*q2d*cos(q1 - q2)^2*sin(q2))/590295810358705651712 + (7889303505444101*q2d*sin(q1 - q2)*cos(q1))/295147905179352825856 - (2868837638343309*q2d*cos(q1 - q2)*sin(q1 - q2)*cos(q2))/590295810358705651712)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976);
    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0;
    0, 0,                                                                                                                                                                               - ((3355693331308689*cos(q1))/144115188075855872 - (1195349015976379*q2d^2*cos(q1 - q2))/9223372036854775808 + (1220252120475887*sin(q1 - q2)*sin(q2))/288230376151711744 - (2259956733330341*q1d^2*cos(q1)^2)/9223372036854775808 - (6711386662617377*cos(q1)*cos(q2)^2)/4611686018427387904 + (2259956733330341*q1d^2*sin(q1)^2)/9223372036854775808 - (4781396063905515*q1d^2*cos(q1 - q2)^2)/36893488147419103232 + (4781396063905515*q1d^2*sin(q1 - q2)^2)/36893488147419103232 + (6848353737364671*u*sin(q1))/4611686018427387904 + (4781396063905515*q2d^2*cos(q1 - q2)*cos(q2)^2)/590295810358705651712 - (27*u*sin(q1 - q2)*cos(q2))/100000 + (1643604896967521*q2d^2*sin(q1)*sin(q2))/36893488147419103232 - (6711386662617377*cos(q2)*sin(q1)*sin(q2))/4611686018427387904 + (6574419587870083*q1d^2*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - (6574419587870083*q1d^2*sin(q1 - q2)*cos(q2)*sin(q1))/73786976294838206464 - (4781396063905515*q2d^2*sin(q1 - q2)*cos(q2)*sin(q2))/590295810358705651712)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976) - (((2259956733330341*cos(q1)*sin(q1))/4611686018427387904 + (4781396063905515*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*cos(q1 - q2)*cos(q2)*sin(q1))/73786976294838206464 - (6574419587870083*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)*((3355693331308689*sin(q1))/144115188075855872 - (1195349015976379*q2d^2*sin(q1 - q2))/9223372036854775808 - (1220252120475887*cos(q1 - q2)*sin(q2))/288230376151711744 - (6711386662617377*cos(q2)^2*sin(q1))/4611686018427387904 - (6848353737364671*u*cos(q1))/4611686018427387904 - (4781396063905515*q1d^2*cos(q1 - q2)*sin(q1 - q2))/36893488147419103232 + (4781396063905515*q2d^2*sin(q1 - q2)*cos(q2)^2)/590295810358705651712 + (27*u*cos(q1 - q2)*cos(q2))/100000 - (2259956733330341*q1d^2*cos(q1)*sin(q1))/9223372036854775808 - (1643604896967521*q2d^2*cos(q1)*sin(q2))/36893488147419103232 + (6711386662617377*cos(q1)*cos(q2)*sin(q2))/4611686018427387904 + (6574419587870083*q1d^2*cos(q1 - q2)*cos(q2)*sin(q1))/147573952589676412928 + (6574419587870083*q1d^2*sin(q1 - q2)*cos(q1)*cos(q2))/147573952589676412928 + (4781396063905515*q2d^2*cos(q1 - q2)*cos(q2)*sin(q2))/590295810358705651712))/((4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 + (2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 - 734641582735483/1152921504606846976)^2, ((2259956733330341*q1d*cos(q1)*sin(q1))/4611686018427387904 + (4781396063905515*q1d*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*q1d*cos(q1 - q2)*cos(q2)*sin(q1))/73786976294838206464 - (6574419587870083*q1d*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976),                                                  ((1220252120475887*cos(q1 - q2)*cos(q2))/288230376151711744 - (1195349015976379*q2d^2*cos(q1 - q2))/9223372036854775808 + (1220252120475887*sin(q1 - q2)*sin(q2))/288230376151711744 - (6711386662617377*cos(q1)*cos(q2)^2)/4611686018427387904 + (6711386662617377*cos(q1)*sin(q2)^2)/4611686018427387904 - (4781396063905515*q1d^2*cos(q1 - q2)^2)/36893488147419103232 + (4781396063905515*q1d^2*sin(q1 - q2)^2)/36893488147419103232 + (4781396063905515*q2d^2*cos(q1 - q2)*sin(q2)^2)/590295810358705651712 + (27*u*cos(q1 - q2)*sin(q2))/100000 - (27*u*sin(q1 - q2)*cos(q2))/100000 + (1643604896967521*q2d^2*cos(q1)*cos(q2))/36893488147419103232 - (6711386662617377*cos(q2)*sin(q1)*sin(q2))/2305843009213693952 + (6574419587870083*q1d^2*cos(q1 - q2)*cos(q1)*cos(q2))/147573952589676412928 + (6574419587870083*q1d^2*cos(q1 - q2)*sin(q1)*sin(q2))/147573952589676412928 + (6574419587870083*q1d^2*sin(q1 - q2)*cos(q1)*sin(q2))/147573952589676412928 - (6574419587870083*q1d^2*sin(q1 - q2)*cos(q2)*sin(q1))/147573952589676412928 + (4781396063905515*q2d^2*sin(q1 - q2)*cos(q2)*sin(q2))/590295810358705651712)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976) - (((5877132661883863*cos(q2)*sin(q2))/73786976294838206464 - (4781396063905515*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*cos(q1 - q2)*cos(q1)*sin(q2))/73786976294838206464 + (6574419587870083*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)*((3355693331308689*sin(q1))/144115188075855872 - (1195349015976379*q2d^2*sin(q1 - q2))/9223372036854775808 - (1220252120475887*cos(q1 - q2)*sin(q2))/288230376151711744 - (6711386662617377*cos(q2)^2*sin(q1))/4611686018427387904 - (6848353737364671*u*cos(q1))/4611686018427387904 - (4781396063905515*q1d^2*cos(q1 - q2)*sin(q1 - q2))/36893488147419103232 + (4781396063905515*q2d^2*sin(q1 - q2)*cos(q2)^2)/590295810358705651712 + (27*u*cos(q1 - q2)*cos(q2))/100000 - (2259956733330341*q1d^2*cos(q1)*sin(q1))/9223372036854775808 - (1643604896967521*q2d^2*cos(q1)*sin(q2))/36893488147419103232 + (6711386662617377*cos(q1)*cos(q2)*sin(q2))/4611686018427387904 + (6574419587870083*q1d^2*cos(q1 - q2)*cos(q2)*sin(q1))/147573952589676412928 + (6574419587870083*q1d^2*sin(q1 - q2)*cos(q1)*cos(q2))/147573952589676412928 + (4781396063905515*q2d^2*cos(q1 - q2)*cos(q2)*sin(q2))/590295810358705651712))/((4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 + (2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 - 734641582735483/1152921504606846976)^2,                   ((1195349015976379*q2d*sin(q1 - q2))/4611686018427387904 - (4781396063905515*q2d*sin(q1 - q2)*cos(q2)^2)/295147905179352825856 + (1643604896967521*q2d*cos(q1)*sin(q2))/18446744073709551616 - (4781396063905515*q2d*cos(q1 - q2)*cos(q2)*sin(q2))/295147905179352825856)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976);
    0, 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1;
    0, 0, ((6711386662617377*cos(q1 - q2)*cos(q1))/288230376151711744 - (5877132661883863*q1d^2*cos(q1 - q2))/9223372036854775808 - (6711386662617377*sin(q1 - q2)*sin(q1))/288230376151711744 - (2307039165274723*cos(q1)^2*cos(q2))/288230376151711744 + (2307039165274723*cos(q2)*sin(q1)^2)/288230376151711744 - (4781396063905515*q2d^2*cos(q1 - q2)^2)/36893488147419103232 + (4781396063905515*q2d^2*sin(q1 - q2)^2)/36893488147419103232 + (4519913466660681*q1d^2*cos(q1 - q2)*sin(q1)^2)/18446744073709551616 + (3424176868682335*u*cos(q1 - q2)*sin(q1))/2305843009213693952 + (3424176868682335*u*sin(q1 - q2)*cos(q1))/2305843009213693952 + (4040528705045155*q1d^2*cos(q1)*cos(q2))/18446744073709551616 - (2307039165274723*cos(q1)*sin(q1)*sin(q2))/144115188075855872 + (6574419587870083*q2d^2*cos(q1 - q2)*cos(q1)*cos(q2))/147573952589676412928 - (4519913466660681*q1d^2*sin(q1 - q2)*cos(q1)*sin(q1))/18446744073709551616 + (6574419587870083*q2d^2*cos(q1 - q2)*sin(q1)*sin(q2))/147573952589676412928 + (6574419587870083*q2d^2*sin(q1 - q2)*cos(q1)*sin(q2))/147573952589676412928 - (6574419587870083*q2d^2*sin(q1 - q2)*cos(q2)*sin(q1))/147573952589676412928)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976) - (((2259956733330341*cos(q1)*sin(q1))/4611686018427387904 + (4781396063905515*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*cos(q1 - q2)*cos(q2)*sin(q1))/73786976294838206464 - (6574419587870083*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)*((5999572925673111*sin(q2))/288230376151711744 + (5877132661883863*q1d^2*sin(q1 - q2))/9223372036854775808 - (6711386662617377*cos(q1 - q2)*sin(q1))/288230376151711744 - (2307039165274723*cos(q1)^2*sin(q2))/288230376151711744 - (6122013189462357*u*cos(q2))/4611686018427387904 + (4781396063905515*q2d^2*cos(q1 - q2)*sin(q1 - q2))/36893488147419103232 - (4519913466660681*q1d^2*sin(q1 - q2)*cos(q1)^2)/18446744073709551616 + (3424176868682335*u*cos(q1 - q2)*cos(q1))/2305843009213693952 - (4040528705045155*q1d^2*cos(q2)*sin(q1))/18446744073709551616 - (5877132661883863*q2d^2*cos(q2)*sin(q2))/147573952589676412928 + (2307039165274723*cos(q1)*cos(q2)*sin(q1))/288230376151711744 + (4519913466660681*q1d^2*cos(q1 - q2)*cos(q1)*sin(q1))/18446744073709551616 + (6574419587870083*q2d^2*cos(q1 - q2)*cos(q1)*sin(q2))/147573952589676412928 - (6574419587870083*q2d^2*sin(q1 - q2)*cos(q1)*cos(q2))/147573952589676412928))/((4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 + (2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 - 734641582735483/1152921504606846976)^2,                      -((5877132661883863*q1d*sin(q1 - q2))/4611686018427387904 - (4519913466660681*q1d*sin(q1 - q2)*cos(q1)^2)/9223372036854775808 - (4040528705045155*q1d*cos(q2)*sin(q1))/9223372036854775808 + (4519913466660681*q1d*cos(q1 - q2)*cos(q1)*sin(q1))/9223372036854775808)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976),                                                                                                  - ((5999572925673111*cos(q2))/288230376151711744 - (5877132661883863*q1d^2*cos(q1 - q2))/9223372036854775808 - (6711386662617377*sin(q1 - q2)*sin(q1))/288230376151711744 - (5877132661883863*q2d^2*cos(q2)^2)/147573952589676412928 - (2307039165274723*cos(q1)^2*cos(q2))/288230376151711744 + (5877132661883863*q2d^2*sin(q2)^2)/147573952589676412928 - (4781396063905515*q2d^2*cos(q1 - q2)^2)/36893488147419103232 + (4781396063905515*q2d^2*sin(q1 - q2)^2)/36893488147419103232 + (6122013189462357*u*sin(q2))/4611686018427387904 + (4519913466660681*q1d^2*cos(q1 - q2)*cos(q1)^2)/18446744073709551616 + (3424176868682335*u*sin(q1 - q2)*cos(q1))/2305843009213693952 + (4040528705045155*q1d^2*sin(q1)*sin(q2))/18446744073709551616 - (2307039165274723*cos(q1)*sin(q1)*sin(q2))/288230376151711744 + (6574419587870083*q2d^2*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 + (4519913466660681*q1d^2*sin(q1 - q2)*cos(q1)*sin(q1))/18446744073709551616 + (6574419587870083*q2d^2*sin(q1 - q2)*cos(q1)*sin(q2))/73786976294838206464)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976) - (((5877132661883863*cos(q2)*sin(q2))/73786976294838206464 - (4781396063905515*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*cos(q1 - q2)*cos(q1)*sin(q2))/73786976294838206464 + (6574419587870083*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)*((5999572925673111*sin(q2))/288230376151711744 + (5877132661883863*q1d^2*sin(q1 - q2))/9223372036854775808 - (6711386662617377*cos(q1 - q2)*sin(q1))/288230376151711744 - (2307039165274723*cos(q1)^2*sin(q2))/288230376151711744 - (6122013189462357*u*cos(q2))/4611686018427387904 + (4781396063905515*q2d^2*cos(q1 - q2)*sin(q1 - q2))/36893488147419103232 - (4519913466660681*q1d^2*sin(q1 - q2)*cos(q1)^2)/18446744073709551616 + (3424176868682335*u*cos(q1 - q2)*cos(q1))/2305843009213693952 - (4040528705045155*q1d^2*cos(q2)*sin(q1))/18446744073709551616 - (5877132661883863*q2d^2*cos(q2)*sin(q2))/147573952589676412928 + (2307039165274723*cos(q1)*cos(q2)*sin(q1))/288230376151711744 + (4519913466660681*q1d^2*cos(q1 - q2)*cos(q1)*sin(q1))/18446744073709551616 + (6574419587870083*q2d^2*cos(q1 - q2)*cos(q1)*sin(q2))/147573952589676412928 - (6574419587870083*q2d^2*sin(q1 - q2)*cos(q1)*cos(q2))/147573952589676412928))/((4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 + (2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 - 734641582735483/1152921504606846976)^2, ((5877132661883863*q2d*cos(q2)*sin(q2))/73786976294838206464 - (4781396063905515*q2d*cos(q1 - q2)*sin(q1 - q2))/18446744073709551616 - (6574419587870083*q2d*cos(q1 - q2)*cos(q1)*sin(q2))/73786976294838206464 + (6574419587870083*q2d*sin(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976)]
B =[
                                                                                                                                                                                                                                                                                                                                                                                            0;
((2988372539940947*cos(q1 - q2)^2)/36893488147419103232 - 7346415827354829/18446744073709551616)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976);
                                                                                                                                                                                                                                                                                                                                                                                            0;
                            ((6848353737364671*cos(q1))/4611686018427387904 - (27*cos(q1 - q2)*cos(q2))/100000)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976);
                                                                                                                                                                                                                                                                                                                                                                                            0;
 ((6122013189462357*cos(q2))/4611686018427387904 - (3424176868682335*cos(q1 - q2)*cos(q1))/2305843009213693952)/((2259956733330341*cos(q1)^2)/9223372036854775808 + (5877132661883863*cos(q2)^2)/147573952589676412928 + (4781396063905515*cos(q1 - q2)^2)/36893488147419103232 - (6574419587870083*cos(q1 - q2)*cos(q1)*cos(q2))/73786976294838206464 - 734641582735483/1152921504606846976)]

Q=[10 0 0 0 0 0; 0 0.1 0 0 0 0;0 0 1 0 0 0; 0 0 0 0.1 0 0;0 0 0 0 1 0;0 0 0 0 0 1];
R=1;
K=lqr(A,B,Q,R)
% K =[3.1623   5.1024 -105.9604   -3.9792  130.4668   20.5577];
% Kfz = [95 32 -91 -60 -6 -25];